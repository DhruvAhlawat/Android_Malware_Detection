# %%
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import os
import time
import sklearn as sk
from sklearn.model_selection import train_test_split
from sklearn.metrics import confusion_matrix, accuracy_score 
from sklearn import svm


# %% [markdown]
# ## Loading the datasets

# %%
DataDict = {}
directory = 'Data/Experimentation/CorrelationSupport'
for file in os.listdir(directory):
    if(file[0] != 'C'):
        continue
    DataDict[file] = pd.read_csv(os.path.join(directory, file)).drop('Name', axis=1)
label = 'isMalware'

# %% [markdown]
# 

# %%
df_train = {}; df_test = {};

for data in DataDict:
    df_train[data], df_test[data] = train_test_split(DataDict[data], test_size=0.3, random_state=47) #, random_state=5)


# %%
SVM = {}
Acc = {}
maxAcc = 0; maxAccName = ""; 

for i in df_train:
    SVM[i] = svm.SVC(kernel='linear')
    SVM[i].fit(df_train[i].drop([label], axis=1), df_train[i][label])
    y_pred = SVM[i].predict(df_test[i].drop([label], axis=1))
    Acc[i] = accuracy_score(df_test[i][label], y_pred)
    if(Acc[i] > maxAcc):
        maxAcc = Acc[i]
        maxAccName = i
    print(i, Acc[i])

print("Max Accuracy: ", maxAcc, " for ", maxAccName)    

# %%



